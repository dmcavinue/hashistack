---
version: '3'

env:
  TF_IN_AUTOMATION: true
  TF_WORKSPACE: "{{.ENVIRONMENT}}"
  TF_INPUT: 0

tasks:
  init:
    desc: Initialize terraform
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform init -upgrade
    silent: true
  plan:
    desc: plan terraform
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform plan
  apply:
    desc: apply terraform
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform apply
  destroy-all:
    desc: destroy terraform
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform destroy
  destroy-hashistack:
    desc: recreate hashistack
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform apply -destroy --target=module.hashistack.aws_instance.this
